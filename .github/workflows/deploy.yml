name: Victory Deploy

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install Stable Clasp
        run: npm install -g @google/clasp@2.4.2

      - name: Create clasprc.json
        run: |
          node -e '
          const fs = require("fs");
          const os = require("os");
          const path = require("path");
          const creds = {
            tokens: {
              default: {
                client_id: "1072944905499-vm2v2i5dvn0a0d2o4ca36i1vge8cvbn0.apps.googleusercontent.com",
                client_secret: "v6V3fKV_zWU7iw1DrpO1rknX",
                refresh_token: "${{ secrets.CLASPRC_JSON }}",
                type: "authorized_user"
              }
            }
          };
          fs.writeFileSync(path.join(os.homedir(), ".clasprc.json"), JSON.stringify(creds));
          '

      - name: Force Script ID & Push
        run: |
          # Διασφαλίζουμε ότι το .clasp.json είναι σωστό στον server
          echo '{"scriptId":"1-Ejerix1enyoDtHA94ycY4EQDSL2yNVlnaB331SQD5-i9Ol2U4v6iuM4","rootDir":"./"}' > .clasp.json
          clasp push --force
          clasp deploy --description "Final Victory"
